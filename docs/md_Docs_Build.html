<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>fdtd3d: Prerequisites</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">fdtd3d
   &#160;<span id="projectnumber">0.5</span>
   </div>
   <div id="projectbrief">FDTD multi-dimensional solver</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)"
               onblur="searchBox.OnSearchFieldFocus(false)"
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0"
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Prerequisites </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Cuda build requires <code>cmake &gt;= 3.8</code>. Cuda builds with older versions of cmake are not supported. To manually build <code>cmake</code> run next commands:</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;./install-cmake.sh</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;export PATH=`pwd`/Third-party/cmake/bin:$PATH</div></div><!-- fragment --><p>Non-cuda builds support <code>cmake &gt;= 3.0.2</code>, but <code>CMakeLists.txt</code> will still require 3.8 version. To build with older versions run next commands: </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;sed -i &#39;s/cmake_minimum_required(VERSION 3\.8)/cmake_minimum_required(VERSION 3\.0\.2)/&#39; CMakeLists.txt</div></div><!-- fragment --><h1>Build Flags</h1>
<p>Solver incorporates following features which could be set up during build.</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;CMAKE_BUILD_TYPE - build type (Debug, RelWithDebInfo, Release)</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;SOLVER_DIM_MODES - dimension modes to include in build (EX_HY;EX_HZ;EY_HX;EY_HZ;EZ_HX;EZ_HY;TEX;TEY;TEZ;TMX;TMY;TMZ;DIM1;DIM2;DIM3;ALL); default value is ALL, which includes all the supported modes</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;VALUE_TYPE - use float (f), double (d) or long double (ld) floating point values</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;COMPLEX_FIELD_VALUES - use complex values or not (ON of OFF)</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;PARALLEL_GRID_DIMENSION - number of dimensions in parallel grid (1, 2 or 3)</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;PRINT_MESSAGE - print debug output (ON or OFF)</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;PARALLEL_GRID - use parallel grid or not (ON or OFF)</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;PARALLEL_BUFFER_DIMENSION - dimension of parallel buffers, i.e. actual coordinate systems (x, y, z, xy, yz, xz, xyz)</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;CXX11_ENABLED - allow support of C++11 (ON or OFF)</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;CUDA_ENABLED - enable support of GPU (ON or OFF)</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;CUDA_ARCH_SM_TYPE - sm type for GPU</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;LARGE_COORDINATES - whether to use int64 for grid coordinates or int32 (ON or OFF)</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;STD_COMPLEX - use std::complex instead of custom CComplex class (std::complex is not supported with Cuda)</div></div><!-- fragment --><p>If any of the flags change or some new are added, testing scripts should be updated.</p>
<h1>Additional Example</h1>
<p>Build command for 3D grid in detail:</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;cmake .. -DCMAKE_BUILD_TYPE=Release -DSOLVER_DIM_MODES=DIM3 -DVALUE_TYPE=d -DCOMPLEX_FIELD_VALUES=OFF \</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;-DPARALLEL_GRID_DIMENSION=3 -DPRINT_MESSAGE=ON -DPARALLEL_GRID=OFF -DPARALLEL_BUFFER_DIMENSION=xyz \</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;-DCXX11_ENABLED=ON -DCUDA_ENABLED=OFF -DCUDA_ARCH_SM_TYPE=sm_50 -DLARGE_COORDINATES=OFF</div></div><!-- fragment --><h1>MPI+Cuda Build</h1>
<p>To build parallel mode with GPU support (MPI+Cuda) do not use mpicc and mpicxx compiler wrappers, because they do not set <code>MPI_CXX_INCLUDE_DIRS</code> and <code>MPI_CXX_LIBRARIES</code>. These are required to be passed to <code>nvcc</code>.</p>
<h1>Build for BlueGene</h1>
<p>BlueGene doesn't have cmake provided, so it should be built from source. Download cmake source and then do the following</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;./bootstrap</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;make</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;# make install won&#39;t work because of lack of root access for ordinary users</div></div><!-- fragment --><p>fdtd3d should also be built in bin folder of cmake (why?).</p>
<p>GCC provided for BlueGene is heavily outdated (4.1.2), thus, it doesn't support c++11 features and fdtd3d should be built with -DCXX11_ENABLED=OFF.</p>
<h2>Issues</h2>
<h3>IBM XL compilers undefined reference</h3>
<p>mpixlcxx and mpixlcxx_r compilers lead to undefined references during linking (supposed that this is a bug in IBM XL compilers). GCC should be used instead (<code>/bgsys/drivers/ppcfloor/comm/bin/mpicxx</code>):</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;../../../../bin/cmake .. -DCMAKE_BUILD_TYPE=Release -DVALUE_TYPE=d -DCOMPLEX_FIELD_VALUES=ON -DSOLVER_DIM_MODES=DIM3 -DPARALLEL_GRID_DIMENSION=3 -DPRINT_MESSAGE=OFF -DPARALLEL_GRID=ON -DPARALLEL_BUFFER_DIMENSION=x -DCXX11_ENABLED=OFF -DCUDA_ENABLED=OFF -DCUDA_ARCH_SM_TYPE=sm_50 -DDYNAMIC_GRID=OFF -DCOMBINED_SENDRECV=ON -DMPI_CLOCK=OFF -DCMAKE_C_COMPILER=/bgsys/drivers/ppcfloor/comm/bin/mpicc -DCMAKE_CXX_COMPILER=/bgsys/drivers/ppcfloor/comm/bin/mpicxx</div></div><!-- fragment --><h3>cmake linking error</h3>
<p>Dynamic mpich libraries are tried to be linked statically (supposed that this is a bug in cmake 3.6). Possible solution is to use newer cmake.</p>
<p>Workaround: build fdtd3d binary manually by replacing paths to dynamic libs with paths to static libs or add <code>-L</code> before <code>.so</code>.</p>
<p>Libs trying to be linked statically: </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;/bgsys/drivers/V1R4M2_200_2010-100508P/ppc/comm/default/lib/libcxxmpich.cnk.so</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;/bgsys/drivers/V1R4M2_200_2010-100508P/ppc/comm/default/lib/libmpich.cnk.so</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;/bgsys/drivers/V1R4M2_200_2010-100508P/ppc/gnu-linux/powerpc-bgp-linux/lib/librt.so</div></div><!-- fragment --><p>Updated command: </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;/bgsys/drivers/ppcfloor/comm/bin/mpicxx    -D_FORCE_INLINES -qmaxmem=-1  -O3  -O3 -DNDEBUG   CMakeFiles/fdtd3d.dir/main.cpp.o  -o fdtd3d /bgsys/drivers/V1R4M2_200_2010-100508P/ppc/comm/default/lib/libcxxmpich.cnk.a /bgsys/drivers/V1R4M2_200_2010-100508P/ppc/comm/default/lib/libmpich.cnk.a /bgsys/drivers/V1R4M2_200_2010-100508P/ppc/comm/default/lib/libopa.a -ldcmf.cnk -ldcmfcoll.cnk -lpthread -lSPI.cna /bgsys/drivers/V1R4M2_200_2010-100508P/ppc/gnu-linux/powerpc-bgp-linux/lib/librt.a Kernels/libKernels.a Settings/libSettings.a Coordinate/libCoordinate.a Grid/libGrid.a Layout/libLayout.a File-Management/Loader/libLoader.a File-Management/Dumper/libDumper.a Scheme/libInternalScheme.a Scheme/libScheme.a File-Management/Loader/libLoader.a File-Management/Dumper/libDumper.a File-Management/libFM.a ../Third-party/EasyBMP/libEasyBMP.a Scheme/libInternalScheme.a Grid/libGrid.a Settings/libSettings.a Helpers/libHelpers.a Layout/libLayout.a Kernels/libKernels.a Coordinate/libCoordinate.a</div></div><!-- fragment --><h1>Build for Tesla CMC</h1>
<p>Add this to <code>cmake</code> command: </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;-DLINK_NUMA=ON</div></div><!-- fragment --> </div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.11
</small></address>
</body>
</html>
